<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Circuit Designer</title>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div class="app-container">
        <!-- Sidebar Controls -->
        <aside class="sidebar" id="sidebar">
            <button id="sidebarToggle" class="sidebar-toggle">❮</button>
            <div class="sidebar-content">
                <div class="logo-area">
                    <h1>Circuit Designer</h1>
                </div>

                <div class="control-group">
                    <h3>Board Size (Holes)</h3>
                    <div class="input-row">
                        <label>Width
                            <div class="spin-wrapper">
                                <button class="spin-btn spin-minus">-</button>
                                <input type="number" id="boardWidth" value="30" min="5" max="100">
                                <button class="spin-btn spin-plus">+</button>
                            </div>
                        </label>
                        <label>Height
                            <div class="spin-wrapper">
                                <button class="spin-btn spin-minus">-</button>
                                <input type="number" id="boardHeight" value="20" min="5" max="100">
                                <button class="spin-btn spin-plus">+</button>
                            </div>
                        </label>
                    </div>
                    <button id="updateBoardBtn" class="primary-btn">Update Board</button>
                </div>

                <div class="control-group">
                    <h3>Wire Settings</h3>
                    <div class="wire-type-toggle">
                        <label class="radio-label">
                            <input type="radio" name="wireType" value="front" checked>
                            <span>Front</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="wireType" value="back">
                            <span>Back</span>
                        </label>
                    </div>

                    <h4>Color</h4>
                    <div class="color-palette" id="colorPalette">
                        <!-- Colors will be generated by JS -->
                    </div>
                </div>

                <div class="control-group">
                    <h3>Component</h3>
                    <div class="input-row">
                        <label style="width:100%">Label <input type="text" id="compLabel" placeholder="IC1"
                                style="width: 100%;"></label>
                    </div>
                    <div class="input-row">
                        <label>Width
                            <div class="spin-wrapper">
                                <button class="spin-btn spin-minus">-</button>
                                <input type="number" id="compWidth" value="4" min="1">
                                <button class="spin-btn spin-plus">+</button>
                            </div>
                        </label>
                        <label>Height
                            <div class="spin-wrapper">
                                <button class="spin-btn spin-minus">-</button>
                                <input type="number" id="compHeight" value="2" min="1">
                                <button class="spin-btn spin-plus">+</button>
                            </div>
                        </label>
                    </div>
                    <div class="input-row">
                        <label style="width:100%">Pins (Top/Right) <textarea id="compPinsTop" rows="1"
                                placeholder="VCC,GND..." style="width: 100%;"></textarea></label>
                    </div>
                    <div style="display:flex; justify-content:center; margin: 6px 0;">
                        <button id="swapCompPinsBtn" class="action-btn"
                            style="font-size: 12px; padding: 2px 8px; width: auto;" title="Swap Top/Bottom">⇅
                            Swap</button>
                    </div>
                    <div class="input-row">
                        <label style="width:100%">Pins (Bottom/Left) <textarea id="compPinsBottom" rows="1"
                                placeholder="A0,A1..." style="width: 100%;"></textarea></label>
                    </div>

                    <!-- Relative Layout Toggle & Rotate -->
                    <!-- Settings Row 1: Relative & Rotate -->
                    <div class="input-row"
                        style="align-items: center; justify-content: space-between; margin-top: 5px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <label class="switch">
                                <input type="checkbox" id="renderRelInput">
                                <span class="slider round"></span>
                            </label>
                            <span style="font-size: 12px; color: #ccc;">Relative</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <label class="switch">
                                <input type="checkbox" id="renderRotInput">
                                <span class="slider round"></span>
                            </label>
                            <span style="font-size: 12px; color: #ccc;">Rotate</span>
                        </div>
                    </div>

                    <!-- Settings Row 2: Board -->
                    <div class="input-row" style="align-items: center; margin-top: 5px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <label class="switch">
                                <input type="checkbox" id="renderBoardInput">
                                <span class="slider round"></span>
                            </label>
                            <span style="font-size: 12px; color: #ccc;">Board</span>
                        </div>
                    </div>

                    <!-- Pin Helper Buttons -->
                    <div class="pin-helpers-container" style="margin-bottom: 10px;">
                        <details>
                            <summary style="cursor: pointer; margin-bottom: 5px;">Pin Presets</summary>
                            <div class="pin-group">
                                <small>Power/Common</small><br>
                                <!-- Focus tracked via App.js -->
                                <div id="commonPinBtns"
                                    style="display: flex; flex-wrap: wrap; gap: 4px; margin-bottom: 5px;"></div>
                            </div>
                            <div class="pin-group">
                                <small>GPIO (G1-G50)</small><br>
                                <div id="gpioPinBtns"
                                    style="display: flex; flex-wrap: wrap; gap: 4px; max-height: 100px; overflow-y: auto;">
                                </div>
                            </div>
                        </details>
                    </div>

                    <div style="display: flex; gap: 5px;">
                        <button id="addComponentBtn" class="secondary-btn" style="flex: 1;">Add</button>
                        <button id="updateComponentBtn" class="secondary-btn" style="flex: 1;" disabled>Update</button>
                    </div>
                    <div style="display: flex; gap: 5px; margin-top: 5px;">
                        <button id="openLibEditorBtn" class="action-btn" style="flex:1;">Edit</button>
                        <button id="importLibBtn" class="action-btn" style="flex:1;">Import</button>
                        <button id="exportLibBtn" class="action-btn" style="flex:1;">Export</button>
                    </div>
                </div>

                <div class="control-group action-buttons" style="display: flex; gap: 5px; flex-direction: column;">
                    <button id="clearBtn" class="danger-btn" style="width: 100%;">Clear All</button>
                    <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                        <button id="saveBtn" class="action-btn" style="flex:1">Save</button>
                        <button id="loadBtn" class="action-btn" style="flex:1">Load</button>
                        <!-- Hidden file inputs -->
                        <input type="file" id="fileInput" accept=".json" style="display: none;">
                        <input type="file" id="libInput" accept=".json" style="display: none;">
                    </div>
                    <button id="exportBtn" class="action-btn" style="width: 100%; margin-top: 5px;">Export PNG</button>
                </div>
            </div>
        </aside>

        <!-- Main Workspace -->
        <main class="workspace">
            <div class="canvas-container">
                <button id="resetViewBtn" class="floating-btn">Center Board</button>
                <canvas id="circuitCanvas" tabindex="0" style="outline: none;"></canvas>
            </div>
        </main>
    </div>

    <!-- Library Manager Modal -->
    <div id="libModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Component Library Editor</h2>
            <div class="lib-modal-body">
                <!-- Left Panel: List -->
                <div class="lib-list-panel">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
                        <h3 style="margin:0;">Components</h3>
                        <div style="gap:5px; display:flex;">
                            <button id="libImportToBoardBtn" class="primary-btn"
                                style="width:auto; padding:4px 10px; font-size:11px;">Import to Board</button>
                        </div>
                    </div>

                    <div class="lib-list-container scrollable-list">
                        <table id="libTable">
                            <thead>
                                <tr>
                                    <th>Label</th>
                                    <th>Size</th>
                                    <th>Pins</th>
                                    <th style="width: 60px; text-align: center;">Config</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>

                    <div class="lib-actions" style="margin-top:10px;">
                        <button id="libSaveBtn" class="secondary-btn">Save JSON</button>
                        <button id="libLoadBtn" class="secondary-btn">Load JSON</button>
                    </div>
                </div>

                <!-- Right Panel: Form -->
                <div class="lib-form-panel">
                    <h4 style="margin: 0 0 10px 0; border-bottom: 1px solid #444; padding-bottom: 5px;">Edit Component
                    </h4>
                    <div class="lib-form-content scrollable-list">
                        <label>Label
                            <input type="text" id="libLabel" placeholder="IC1" style="width:100%">
                        </label>

                        <div style="display: flex; gap: 10px;">
                            <label style="flex:1">Width
                                <input type="number" id="libW" value="4" min="1" style="width:100%">
                            </label>
                            <label style="flex:1">Height
                                <input type="number" id="libH" value="2" min="1" style="width:100%">
                            </label>
                        </div>

                        <label>Pins (Top/Right)
                            <textarea id="libPinsTop" rows="1" placeholder="GND,VCC..." style="width: 100%;"></textarea>
                        </label>

                        <div style="text-align: center; margin: 6px 0;">
                            <button id="swapLibPinsBtn" class="action-btn"
                                style="font-size: 12px; padding: 2px 8px; width: auto;" title="Swap Top/Bottom">⇅
                                Swap</button>
                        </div>

                        <label>Pins (Bottom/Left)
                            <textarea id="libPinsBottom" rows="1" placeholder="A0,A1..."
                                style="width: 100%;"></textarea>
                        </label>

                        <!-- Relative & Rotate for Library -->
                        <div class="input-row"
                            style="align-items: center; justify-content: space-between; margin-top: 5px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <label class="switch">
                                    <input type="checkbox" id="libRenderRel">
                                    <span class="slider round"></span>
                                </label>
                                <span style="font-size: 12px; color: #ccc;">Relative</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <label class="switch">
                                    <input type="checkbox" id="libRenderRot">
                                    <span class="slider round"></span>
                                </label>
                                <span style="font-size: 12px; color: #ccc;">Rotate</span>
                            </div>
                        </div>

                        <div class="input-row" style="align-items: center; margin-top: 5px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <label class="switch">
                                    <input type="checkbox" id="libRenderBoard">
                                    <span class="slider round"></span>
                                </label>
                                <span style="font-size: 12px; color: #ccc;">Board</span>
                            </div>
                        </div>

                        <!-- Pin Helpers Structured -->
                        <div class="pin-helpers-container" style="margin-top: 10px;">
                            <details open>
                                <summary style="cursor: pointer; margin-bottom: 5px;">Pin Presets</summary>
                                <div class="pin-group">
                                    <small>Power/Common</small><br>
                                    <div id="libCommonPinBtns"
                                        style="display: flex; flex-wrap: wrap; gap: 4px; margin-bottom: 5px;"></div>
                                </div>
                                <div class="pin-group">
                                    <small>GPIO (G1-G50)</small><br>
                                    <div id="libGpioPinBtns"
                                        style="display: flex; flex-wrap: wrap; gap: 4px; max-height: 100px; overflow-y: auto;">
                                    </div>
                                </div>
                            </details>
                        </div>
                    </div>

                    <div class="lib-form-footer"
                        style="padding-top:10px; border-top:1px solid #444; display:flex; gap:10px;">
                        <button id="libAddBtn" class="primary-btn" style="flex:1;">Add New</button>
                        <button id="libUpdateBtn" class="secondary-btn" style="flex:1;" disabled>Update</button>
                        <button id="libDeleteBtn" class="danger-btn" style="flex:1;" disabled>Delete</button>
                    </div>
                </div>
            </div>
        </div>

        <script src="js/canvas.js"></script>
        <script src="js/app.js"></script>
</body>

</html>